/*!
 * jQuery Title Card Player plugin
 *
 * @requires    jQuery Core v1.8 or later
 * @requires    jQuery UI v1.8.23 or later
 * @requires    9x9 SDK (nn-sdk.js)
 * @author      Chih-Wen Yang <chihwen@doubleservice.com>
 * @version     1.6.2
 */
;(function($){$.fn.titlecard=function(options,callback){nn.log({options:options,callback:callback},'debug');var strip_tags=function(input,allowed){allowed=allowed||'';allowed+='';allowed=(allowed.toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(commentsAndPhpTags,'').replace(tags,function($0,$1){return allowed.indexOf('<'+$1.toLowerCase()+'>')>-1?$0:'';});};var destroy=function(element,func){var callback=null;if('function'===typeof func){callback=func;}
element.clearQueue().stop().children().clearQueue().stop().children().clearQueue().stop().children().clearQueue().stop().end().end().hide('fast',callback);};var playedCallback=null,cancelCallback=null;if(undefined===options){nn.log('play with default values','debug');playedCallback=null;}else{var isPassParamCheck=false;if('string'===typeof options){if('cancel'===options){isPassParamCheck=true;if('function'===typeof callback){nn.log('setup cancel callback','debug');cancelCallback=callback;}
nn.log('cancel playing title card, release resources','debug');destroy($(this),cancelCallback);}else{nn.log('param error nothing to do','error');}
return;}
if('function'===typeof options||'function'===typeof callback){nn.log('setup played callback','debug');if('function'===typeof options){isPassParamCheck=true;playedCallback=options;options={};}else{playedCallback=callback;}}
if('object'===typeof options){isPassParamCheck=true;nn.log('setup options','debug');}
if(!isPassParamCheck){nn.log('param error nothing to do','error');return;}}
var opts=$.extend({},$.fn.titlecard.defaults,options||{});nn.log({opts:opts,playedCallback:playedCallback},'debug');return this.each(function(){var $this=$(this),width=(opts.width&&opts.width<=$this.width())?parseInt(opts.width,10):$this.width(),height=(opts.height&&opts.height<=$this.height())?parseInt(opts.height,10):$this.height(),heightTemp=0,outerFloat='none',outerMarginTop=0,text=strip_tags($.trim(opts.text)).replace(/(\n|\{BR\})/g,'<br />'),align=opts.align,fontRadix=parseInt(opts.fontSize,10),fontSize=0,fontStyle=opts.fontStyle,fontWeight=opts.fontWeight,wrapperId=(this.id)?(this.id+'-'):'',wrapperCanvas=wrapperId+'wrapper-canvas',wrapperOuter=wrapperId+'wrapper-outer',wrapperMiddle=wrapperId+'wrapper-middle',wrapperInner=wrapperId+'wrapper-inner',wrapperHtml='';if(opts.widescreen){heightTemp=Math.round((width/16)*9);if(heightTemp>height){width=Math.round((height/9)*16);}else{height=heightTemp;}}
if($this.height()>height){outerFloat='left';outerMarginTop=(($this.height()-height)/2)+'px';}
if(fontRadix<$.fn.titlecard.allows.fontSize.min||fontRadix>$.fn.titlecard.allows.fontSize.max){fontRadix=$.fn.titlecard.defaults.fontSize;}
fontSize=Math.round(width/fontRadix);if(-1===$.inArray(align,$.fn.titlecard.allows.align)){align=$.fn.titlecard.defaults.align;}
if(-1===$.inArray(fontStyle,$.fn.titlecard.allows.fontStyle)){fontStyle=$.fn.titlecard.defaults.fontStyle;}
if(-1===$.inArray(fontWeight,$.fn.titlecard.allows.fontWeight)){fontWeight=$.fn.titlecard.defaults.fontWeight;}
wrapperHtml='<div class="'+wrapperCanvas+'"><div class="'+wrapperOuter+'">';wrapperHtml+='<div class="'+wrapperMiddle+'"><div class="'+wrapperInner+'"></div></div>';if((''!==opts.backgroundImage&&''===opts.backgroundColor)||(''!==opts.backgroundImage&&''!==opts.backgroundColor&&$.fn.titlecard.system.backgroundImage!==opts.backgroundImage)){wrapperHtml+='<img src="'+opts.backgroundImage+'" style="width: 100%; height: 100%; border: none;" />';}
wrapperHtml+='</div></div>';$this.show().wrapInner(wrapperHtml).children('.'+wrapperCanvas).hide().css({display:'block',width:'100%',height:'100%',backgroundColor:'#000'}).children('.'+wrapperOuter).hide().css({display:'block',position:'relative',overflow:'hidden',zIndex:50,"float":outerFloat,width:width+'px',height:height+'px',margin:outerMarginTop+' auto',backgroundColor:opts.backgroundColor}).children('.'+wrapperMiddle).hide().css({display:'block',position:'absolute',width:'100%',height:'100%'}).children('.'+wrapperInner).hide().html(text).css({display:'block',position:'absolute',left:'1%',width:'98%',height:'auto',textAlign:align,fontSize:fontSize+'pt',color:opts.fontColor,fontStyle:fontStyle,fontWeight:fontWeight});var selfWidth=$this.children().children('.'+wrapperOuter).children('.'+wrapperMiddle).children('.'+wrapperInner).width(),selfHeight=$this.children().children('.'+wrapperOuter).children('.'+wrapperMiddle).children('.'+wrapperInner).height(),selfLeft=0,selfTop=0;if(width>selfWidth){selfLeft=(width-selfWidth)/2;}
if(height>selfHeight){selfTop=(height-selfHeight)/2;}
$this.children().children('.'+wrapperOuter).children('.'+wrapperMiddle).children('.'+wrapperInner).css({top:selfTop+'px',left:selfLeft+'px'});var effect=opts.effect,duration=parseInt(opts.duration,10),startStandbySec=500,endingStandbySec=500,startSec=1500,endingSec=1500,delaySec=3000;if(-1===$.inArray(effect,$.fn.titlecard.allows.effect)){effect=$.fn.titlecard.defaults.effect;}
if(duration<$.fn.titlecard.allows.duration.min||duration>$.fn.titlecard.allows.duration.max){duration=$.fn.titlecard.defaults.duration;}
duration*=1000;if(-1!==$.inArray(effect,['blind','clip','drop'])){startSec=endingSec=1000;}
if('none'===effect){startStandbySec=endingStandbySec=startSec=endingSec=0;}
delaySec=(duration-startStandbySec-startSec-endingSec-endingStandbySec);switch(effect){case'blind':case'clip':case'fold':case'drop':case'bounce':case'explode':case'highlight':case'puff':case'pulsate':case'scale':case'shake':case'slide':$this.children().children().show(startStandbySec).children('.'+wrapperMiddle).hide().show(effect,{},startSec).delay(delaySec).hide(effect,{},endingSec,function(){$this.children().delay(endingStandbySec).hide(0,playedCallback);});break;case'fade':$this.children().children().show(startStandbySec).children('.'+wrapperMiddle).hide().fadeIn(startSec).delay(delaySec).fadeOut(endingSec,function(){$this.children().delay(endingStandbySec).hide(0,playedCallback);});break;default:$this.children().children().children().show(0).delay(duration).hide(0,function(){$this.children().hide(0,playedCallback);});break;}
$(window).bind('resize',function(){var width=$this.width(),height=$this.height(),heightTemp=0,outerFloat='none',outerMarginTop=0;if(opts.widescreen){heightTemp=Math.round((width/16)*9);if(heightTemp>height){width=Math.round((height/9)*16);}else{height=heightTemp;}}
if($this.height()>height){outerFloat='left';outerMarginTop=(($this.height()-height)/2)+'px';}
$this.children().children('.'+wrapperOuter).css({"float":outerFloat,width:width,height:height,margin:outerMarginTop+' auto'}).children('.'+wrapperMiddle).children('.'+wrapperInner).css({fontSize:Math.round(width/fontRadix)+'pt'});var selfWidth=$this.children().children('.'+wrapperOuter).children('.'+wrapperMiddle).children('.'+wrapperInner).width(),selfHeight=$this.children().children('.'+wrapperOuter).children('.'+wrapperMiddle).children('.'+wrapperInner).height(),selfLeft=0,selfTop=0;if(width>selfWidth){selfLeft=(width-selfWidth)/2;}
if(height>selfHeight){selfTop=(height-selfHeight)/2;}
$this.children().children('.'+wrapperOuter).children('.'+wrapperMiddle).children('.'+wrapperInner).css({top:selfTop+'px',left:selfLeft+'px'});});});};$.fn.titlecard.defaults={widescreen:true,width:null,height:null,text:'My video',align:'center',effect:'none',duration:7,fontSize:20,fontColor:'white',fontStyle:'normal',fontWeight:'normal',backgroundColor:'black',backgroundImage:''};$.fn.titlecard.allows={align:['left','center','right'],effect:['none','fade','blind','clip','fold','drop','bounce','explode','highlight','puff','pulsate','scale','shake','slide'],duration:{min:5,max:20},fontSize:{min:6,max:48},fontStyle:['normal','italic'],fontWeight:['normal','bold','bolder']};$.fn.titlecard.system={backgroundImage:'http://9x9ui.s3.amazonaws.com/war/v0/images/titlecard-default.png'};}(jQuery));