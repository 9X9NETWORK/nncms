/*!
 * Revised by marshsu@gmail.com added countDown flag for count down and count up at 2013/07/19
 * Revised by chihwen@doubleservice.com added multibyte counter and clear feature.
 * jquery.charcounter.js version 1.3
 * requires jQuery version 1.2 or higher
 * Copyright (c) 2007 Tom Deater (http://www.tomdeater.com)
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 * predefine global variables: jQuery window escape setTimeout
 * JSLint Directive Options: jslint eqeq: true, plusplus: true, regexp: true, sloppy: true
 */
;(function(e){e.fn.charCounter=function(t,n){function s(e){var t,r,i,s,o,u;t=e.length;r=i=0;if(t>0){for(u=0;u<t;u++){s=escape(e.charAt(u));if("%"==s.charAt(0)){o=s.charAt(1);if("A"==o||"u"==o){r+=2;i+=1}else{r+=1}}else{r+=1}}}if(n.cntdivide){r=r/2}return[r,i]}function o(t,n){if(r){window.clearTimeout(r);r=null}t.animate({opacity:.1},100,function(){e(this).animate({opacity:1},100)});if(n){r=window.setTimeout(function(){o(t)},200)}}function u(u,a){u=e(u);var f,l,c,h,d;f=s(u.val());l=n.multibyte?f[0]:u.val().length;c=n.multibyte?f[1]:0;if(n.clear&&l>t){h=n.cntdivide?t*2-c:t-c;u.val(u.val().substring(0,h));if(n.pulse&&!r){o(a,true)}}if(n.countDown){d=t-l}else{d=l}if(n.delay>0){if(i){window.clearTimeout(i)}i=window.setTimeout(function(){a.html(n.format.replace(/%1/,d))},n.delay)}else{a.html(n.format.replace(/%1/,d))}}t=t||100;n=e.extend({container:"<span></span>",classname:"charcounter",format:"(%1 characters remaining)",pulse:true,delay:0,multibyte:false,cntdivide:false,clear:true,countDown:true},n);n.cntdivide=n.multibyte&&n.cntdivide?true:false;var r,i;return this.each(function(){var t;if(!n.container.match(/^<.+>$/)){t=e(n.container)}else{e(this).next("."+n.classname).remove();t=e(n.container).insertAfter(this).addClass(n.classname)}e(this).unbind(".charCounter").bind("keydown.charCounter",function(){u(this,t)}).bind("keypress.charCounter",function(){u(this,t)}).bind("keyup.charCounter",function(){u(this,t)}).bind("focus.charCounter",function(){u(this,t)}).bind("mouseover.charCounter",function(){u(this,t)}).bind("mouseout.charCounter",function(){u(this,t)}).bind("paste.charCounter",function(){var e=this;setTimeout(function(){u(e,t)},10)});if(this.addEventListener){this.addEventListener("input",function(){u(this,t)},false)}u(this,t)})}})(jQuery)